<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Raspadita de Bienvenida üéÅ</title>
  <meta name="description" content="Raspa y descubre tu cup√≥n de bienvenida: 50% extra en tu primera carga. V√°lido 24 horas." />
  <style>
    :root{
      --bg1:#f8f9ff; --bg2:#eef2ff; --primary:#111827; --accent:#6366f1; --ok:#16a34a; --muted:#6b7280;
      --card:#ffffff; --shadow:0 10px 30px rgba(0,0,0,.12);
      --radius:22px;
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family: ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial;
      min-height:100vh; display:flex; align-items:center; justify-content:center;
      background: radial-gradient(1200px 600px at 10% 10%, var(--bg2), transparent),
                  radial-gradient(1200px 600px at 90% 90%, #ffe8ef, transparent),
                  var(--bg1);
      color:var(--primary);
    }
    .wrap{
      width:min(92vw, 560px);
      background:var(--card);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:22px;
    }
    header{
      display:flex; align-items:center; gap:12px; margin-bottom:14px;
    }
    .logo{
      width:50px; height:50px; border-radius:12px; background:#fff;
      box-shadow:0 4px 12px rgba(0,0,0,.08); display:grid; place-items:center; overflow:hidden;
      flex:0 0 auto;
    }
    .logo img{ width:100%; height:100%; object-fit:cover; }
    .ttl{ line-height:1.1; }
    .ttl h1{ font-size:20px; margin:0 0 4px; }
    .ttl p{ margin:0; color:var(--muted); font-size:14px; }

    .card{
      position:relative; border-radius:var(--radius);
      overflow:hidden; box-shadow:var(--shadow);
      aspect-ratio: 26 / 15; 
      background:#fff;
    }
    .coupon-img{
      position:absolute; inset:0;
      width:100%; height:100%; object-fit:cover; display:block;
    }
    .scratch{
      position:absolute; inset:0;
      width:100%; height:100%; display:block; cursor:pointer;
    }
    .badge{
      position:absolute; top:10px; right:10px; background:var(--accent); color:#fff;
      padding:6px 10px; border-radius:999px; font-size:12px; box-shadow:0 4px 10px rgba(99,102,241,.4);
      z-index:3;
    }
    .ribbon{
      position:absolute; left:10px; top:10px; padding:6px 10px; font-size:12px; background:#111827; color:#fff; border-radius:999px;
      z-index:3;
    }
    .expiredOverlay{
      position:absolute; inset:0; background:rgba(17,24,39,.72); color:#fff;
      display:none; align-items:center; justify-content:center; text-align:center; padding:20px; z-index:4;
    }
    .expiredOverlay.show{ display:flex; }

    .cta{
      display:flex; flex-direction:column; align-items:center; gap:10px; margin-top:16px; text-align:center;
    }
    .btn{
      appearance:none; border:0; background:var(--ok); color:#fff; font-weight:700;
      padding:14px 18px; border-radius:16px; box-shadow:0 6px 16px rgba(22,163,74,.35);
      cursor:pointer; width:100%; font-size:16px; transition:transform .06s ease;
    }
    .btn:disabled{ background:#a3a3a3; box-shadow:none; cursor:not-allowed; }
    .btn:active{ transform:translateY(1px); }
    .meta{ font-size:13px; color:var(--muted); }
    details{ margin-top:10px; background:#f6f7ff; border-radius:14px; padding:10px 12px; }
    details summary{ cursor:pointer; font-weight:600; }

    .grid2{ display:grid; grid-template-columns:1fr auto; gap:10px; align-items:center; }
    .extra-lines{ margin-top:12px; text-align:left; font-size:13px; color:var(--muted); }
    .extra-lines p{ margin:4px 0; }
  </style>
</head>
<body>
  <div class="wrap" role="main">
    <header>
      <div class="logo">
        <img id="brandLogo" alt="Logo" src="./logo.png" />
      </div>
      <div class="ttl">
        <h1>Raspadita de Bienvenida</h1>
        <p>Descubre tu cup√≥n exclusivo.</p>
      </div>
    </header>

    <div class="card">
      <div class="ribbon">CARGA EXTRA</div>
      <div class="badge" id="timeBadge">
        <span class="timer">‚è≥ <span id="countdown">‚Äî:‚Äî:‚Äî</span></span>
      </div>

      <img id="couponImg" class="coupon-img" src="./cupon.png" alt="Cup√≥n" loading="eager" />

      <canvas id="scratch" class="scratch" aria-label="Raspadita: arrastra para revelar premio"></canvas>

      <div class="expiredOverlay" id="expired">
        <div>
          <h2 style="margin:0 0 6px">Cup√≥n expirado</h2>
          <p style="margin:0; opacity:.9">Vuelve a solicitar una nueva invitaci√≥n.</p>
        </div>
      </div>
    </div>

    <div class="cta">
      <div class="grid2" style="width:100%">
        <button id="claimBtn" class="btn" disabled>üéÅ Reclamar cup√≥n</button>
        <div class="meta" id="progressTxt">Raspa para desbloquear (0%)</div>
      </div>
      <div class="meta">V√°lido solo por 24 horas desde tu primera visita.</div>
      <details>
        <summary>Ver t√©rminos</summary>
        <div class="meta" style="margin-top:8px; text-align:left">
          Promoci√≥n: 50% extra en la primera carga de bienvenida. V√°lido por 24 horas desde la primera visita a esta p√°gina en tu dispositivo.
          Beneficio no acumulable ni transferible. Sujeto a verificaci√≥n de cuenta. Nos reservamos el derecho de validar elegibilidad.
        </div>
      </details>
    </div>

    <div class="extra-lines">
      <p>1. Beneficio exclusivo para nuevos usuarios.</p>
      <p>2. No acumulable con otras promociones.</p>
      <p>3. V√°lido solo en la primera carga.</p>
      <p>4. Vigencia limitada a 24 horas.</p>
      <p>5. Cup√≥n personal e intransferible.</p>
      <p>6. Sujeto a verificaci√≥n de identidad.</p>
      <p>7. Promoci√≥n v√°lida hasta agotar stock.</p>
      <p>8. La empresa se reserva el derecho de modificar condiciones.</p>
    </div>
  </div>

  <script>
    /***********************
     * CONFIG
     ***********************/
    const BRAND_NAME = "Tu Marca";
    const VALIDITY_HOURS = 24;
    const SCRATCH_RADIUS = 26;
    const UNLOCK_THRESHOLD = 0.55;

    // üëâ Aqu√≠ defines tus 8 n√∫meros de WhatsApp (en formato internacional, sin + ni espacios)
    const WHATSAPP_NUMBERS = [
      "5491131173310",
      "5491131173484",
      "5491131173032",
      "5491131173532",
      "5491131173034",
      "5491131173049",
      "5491777777777",
      "5491888888888"
    ];

    const canvas = document.getElementById("scratch");
    const ctx = canvas.getContext("2d");
    const claimBtn = document.getElementById("claimBtn");
    const progressTxt = document.getElementById("progressTxt");
    const countdownEl = document.getElementById("countdown");
    const expiredEl = document.getElementById("expired");

    let isDown = false, lastPoint = null, revealed = false;

    function sizeCanvas(){
      const dpr = window.devicePixelRatio || 1;
      const rect = canvas.getBoundingClientRect();
      canvas.width  = Math.round(rect.width * dpr);
      canvas.height = Math.round(rect.height * dpr);
      ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
    }

    function drawScratchLayer(){
      const rect = canvas.getBoundingClientRect();
      const w = rect.width, h = rect.height;
      const g = ctx.createLinearGradient(0,0,w,h);
      g.addColorStop(0, "#cfd4da");
      g.addColorStop(1, "#a9b0b7");
      ctx.globalCompositeOperation = "source-over";
      ctx.fillStyle = g;
      ctx.fillRect(0,0,w,h);
      ctx.globalAlpha = 0.25;
      ctx.fillStyle = "rgba(255,255,255,0.3)";
      for(let i=0;i<w;i+=8){ ctx.fillRect(i,0,1,h); }
      ctx.globalAlpha = 1;
      ctx.fillStyle = "rgba(17,24,39,.9)";
      ctx.font = "bold 20px system-ui, -apple-system, Segoe UI, Roboto, Arial";
      ctx.textAlign = "center";
      ctx.fillText("Raspa para revelar tu cup√≥n", w/2, 40);
      ctx.textAlign = "left";
    }

    function scratchAt(clientX, clientY){
      const rect = canvas.getBoundingClientRect();
      const x = (clientX - rect.left);
      const y = (clientY - rect.top);
      ctx.globalCompositeOperation = "destination-out";
      ctx.beginPath();
      ctx.arc(x, y, SCRATCH_RADIUS, 0, Math.PI*2);
      ctx.fill();
      if(lastPoint){
        const dx = x - lastPoint.x, dy = y - lastPoint.y;
        const dist = Math.hypot(dx, dy);
        const steps = Math.ceil(dist / (SCRATCH_RADIUS/2));
        for(let i=1;i<steps;i++){
          const ix = lastPoint.x + dx*(i/steps);
          const iy = lastPoint.y + dy*(i/steps);
          ctx.beginPath(); ctx.arc(ix, iy, SCRATCH_RADIUS, 0, Math.PI*2); ctx.fill();
        }
      }
      lastPoint = {x,y};
    }

    function updateRevealedPercent(){
      try{
        const data = ctx.getImageData(0,0,canvas.width,canvas.height).data;
        let cleared = 0, sampled = 0;
        for(let i=3;i<data.length;i+=32){
          if(data[i]===0) cleared++;
          sampled++;
        }
        const ratio = cleared / sampled;
        const percent = Math.round(ratio*100);
        progressTxt.textContent = revealed ? "Listo para reclamar" : `Raspa para desbloquear (${percent}%)`;
        if(!revealed && ratio >= UNLOCK_THRESHOLD){
          revealed = true;
          ctx.globalCompositeOperation = "destination-out";
          ctx.fillRect(0,0,canvas.width,canvas.height);
          claimBtn.disabled = false;
          progressTxt.textContent = "Listo para reclamar";
        }
      }catch(e){}
    }

    function handlePointerDown(){ if(!checkExpired()){ isDown = true; lastPoint = null; } }
    function handlePointerUp(){ isDown = false; lastPoint = null; updateRevealedPercent(); }
    function handlePointerMove(e){
      if(!isDown || checkExpired()) return;
      const t = e.touches && e.touches[0];
      scratchAt(t ? t.clientX : e.clientX, t ? t.clientY : e.clientY);
      e.preventDefault();
    }

    canvas.addEventListener("mousedown", handlePointerDown);
    canvas.addEventListener("mousemove", handlePointerMove, {passive:false});
    window.addEventListener("mouseup", handlePointerUp);
    canvas.addEventListener("touchstart", handlePointerDown, {passive:true});
    canvas.addEventListener("touchmove", handlePointerMove, {passive:false});
    window.addEventListener("touchend", handlePointerUp);

    /***********************
     * EXPIRACI√ìN
     ***********************/
    const STORAGE_KEY = "scratch_welcome_started_at";
    function getStartMs(){ const v = localStorage.getItem(STORAGE_KEY); return v ? parseInt(v,10) : null; }
    function startNowIfNeeded(){ let s = getStartMs(); if(!s){ s = Date.now(); localStorage.setItem(STORAGE_KEY, String(s)); } return s; }
    function msLeft(){ const end = startNowIfNeeded() + VALIDITY_HOURS*60*60*1000; return end - Date.now(); }
    function checkExpired(){ const expired = msLeft()<=0; expiredEl.classList.toggle("show", expired); claimBtn.disabled = expired || !revealed; return expired; }
    function hhmmss(ms){ if(ms<=0) return "00:00:00"; const t=Math.floor(ms/1000),h=String(Math.floor(t/3600)).padStart(2,"0"),m=String(Math.floor((t%3600)/60)).padStart(2,"0"),s=String(t%60).padStart(2,"0"); return `${h}:${m}:${s}`; }
    function tick(){ const left=msLeft(); countdownEl.textContent = hhmmss(left); checkExpired(); }
    setInterval(tick, 1000);

    /***********************
     * CTA con redirecci√≥n a WhatsApp
     ***********************/
    claimBtn.addEventListener("click", () => {
      if(checkExpired()) return;
      const randomNum = WHATSAPP_NUMBERS[Math.floor(Math.random() * WHATSAPP_NUMBERS.length)];
      const mensaje = encodeURIComponent("¬°Hola! Quiero reclamar mi cup√≥n de bienvenida üéÅ");
      const url = `https://wa.me/${randomNum}?text=${mensaje}`;
      window.open(url, "_blank");
    });

    /***********************
     * INIT
     ***********************/
    function init(){
      sizeCanvas();
      drawScratchLayer();
      tick();
    }
    window.addEventListener("load", init);
    window.addEventListener("resize", () => { sizeCanvas(); drawScratchLayer(); });
  </script>
</body>
</html>
