<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Raspadita de Bienvenida üéÅ</title>
  <meta name="description" content="Raspa y descubre tu cup√≥n de bienvenida: 50% extra en tu primera carga. V√°lido 24 horas." />
  <style>
    :root{
      --bg1:#f8f9ff; --bg2:#eef2ff; --primary:#111827; --accent:#6366f1; --ok:#16a34a; --muted:#6b7280;
      --card:#ffffff; --shadow:0 10px 30px rgba(0,0,0,.12);
      --radius:22px;
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family: ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial;
      min-height:100vh; display:flex; align-items:center; justify-content:center;
      background: radial-gradient(1200px 600px at 10% 10%, var(--bg2), transparent),
                  radial-gradient(1200px 600px at 90% 90%, #ffe8ef, transparent),
                  var(--bg1);
      color:var(--primary);
    }
    .wrap{
      width:min(92vw, 560px);
      background:var(--card);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:22px;
    }
    header{
      display:flex; align-items:center; gap:12px; margin-bottom:14px;
    }
    .logo{
      width:42px; height:42px; border-radius:12px; background:#fff;
      box-shadow:0 4px 12px rgba(0,0,0,.08); display:grid; place-items:center; overflow:hidden;
      flex:0 0 auto;
    }
    .logo img{ width:100%; height:100%; object-fit:cover; }
    .ttl{ line-height:1.1; }
    .ttl h1{ font-size:20px; margin:0 0 4px; }
    .ttl p{ margin:0; color:var(--muted); font-size:14px; }

    .card{
      position:relative; border-radius:var(--radius);
      overflow:hidden; box-shadow:0 6px 18px rgba(0,0,0,.12);
    }
    canvas{ display:block; width:100%; height:auto; cursor:pointer; }
    .badge{
      position:absolute; top:10px; right:10px; background:var(--accent); color:#fff;
      padding:6px 10px; border-radius:999px; font-size:12px; box-shadow:0 4px 10px rgba(99,102,241,.4);
    }
    .cta{
      display:flex; flex-direction:column; align-items:center; gap:10px; margin-top:16px; text-align:center;
    }
    .btn{
      appearance:none; border:0; background:var(--ok); color:#fff; font-weight:700;
      padding:14px 18px; border-radius:16px; box-shadow:0 6px 16px rgba(22,163,74,.35);
      cursor:pointer; width:100%; font-size:16px; transition:transform .06s ease;
    }
    .btn:disabled{ background:#a3a3a3; box-shadow:none; cursor:not-allowed; }
    .btn:active{ transform:translateY(1px); }
    .meta{ font-size:13px; color:var(--muted); }
    details{ margin-top:10px; background:#f6f7ff; border-radius:14px; padding:10px 12px; }
    details summary{ cursor:pointer; font-weight:600; }
    .ribbon{
      position:absolute; left:10px; top:10px; padding:6px 10px; font-size:12px; background:#111827; color:#fff; border-radius:999px;
    }
    .expiredOverlay{
      position:absolute; inset:0; background:rgba(17,24,39,.72); color:#fff;
      display:none; align-items:center; justify-content:center; text-align:center; padding:20px;
    }
    .expiredOverlay.show{ display:flex; }
    .timer{ display:inline-flex; gap:6px; align-items:center; font-feature-settings:"tnum"; font-variant-numeric:tabular-nums; }
    .grid2{ display:grid; grid-template-columns:1fr auto; gap:10px; align-items:center; }
  </style>
</head>
<body>
  <div class="wrap" role="main">
    <header>
      <div class="logo"><img src="logo.png" alt="Logo de tu marca"></div>
      <div class="ttl">
        <h1>Raspadita de Bienvenida</h1>
        <p>Descubre tu cup√≥n exclusivo</p>
      </div>
    </header>

    <div class="card">
      <div class="ribbon">50% EXTRA</div>
      <div class="badge" id="timeBadge"><span class="timer">‚è≥ <span id="countdown">‚Äî:‚Äî:‚Äî</span></span></div>
      <canvas id="scratch" width="520" height="300"></canvas>
      <div class="expiredOverlay" id="expired">
        <div>
          <h2 style="margin:0 0 6px">Cup√≥n expirado</h2>
          <p style="margin:0; opacity:.9">Vuelve a solicitar una nueva invitaci√≥n.</p>
        </div>
      </div>
    </div>

    <div class="cta">
      <div class="grid2" style="width:100%">
        <button id="claimBtn" class="btn" disabled>üéÅ Reclamar cup√≥n 50% extra</button>
        <div class="meta" id="progressTxt">Raspa para desbloquear (0%)</div>
      </div>
      <div class="meta">‚ö° V√°lido solo por 24 horas desde tu primera visita.</div>
    </div>
  </div>

  <script>
    /***********************
     * üîß CONFIGURACI√ìN
     ***********************/
    const VALIDITY_HOURS = 24;        // Duraci√≥n en horas
    const SCRATCH_RADIUS = 26;        // Radio de raspado
    const UNLOCK_THRESHOLD = 0.55;    // 55% revelado
    const WHATSAPP_NUMBER = "";       // N√∫mero con c√≥digo de pa√≠s (ej: 54911xxxxxxxx)
    const WHATSAPP_MESSAGE = "Hola, quiero reclamar mi cup√≥n de bienvenida 50% EXTRA.";

    const canvas = document.getElementById("scratch");
    const ctx = canvas.getContext("2d");
    const claimBtn = document.getElementById("claimBtn");
    const progressTxt = document.getElementById("progressTxt");
    const countdownEl = document.getElementById("countdown");
    const expiredEl = document.getElementById("expired");

    /***********************
     * üé® DIBUJA PREMIO
     ***********************/
    function drawPrizeBackground() {
      const w = canvas.width, h = canvas.height;
      ctx.fillStyle = "#fff"; ctx.fillRect(0,0,w,h);
      ctx.fillStyle = "#16a34a"; ctx.font = "bold 28px Arial";
      ctx.fillText("üéâ Cup√≥n 50% EXTRA", 30, 100);
      ctx.fillStyle = "#111"; ctx.font = "18px Arial";
      ctx.fillText("en tu primera carga de bienvenida", 30, 140);
      ctx.fillStyle = "#6b7280"; ctx.font = "14px Arial";
      ctx.fillText("V√°lido por 24 horas desde tu visita", 30, 180);
    }

    /***********************
     * ü™Ñ CAPA RASCABLE
     ***********************/
    function drawScratchLayer(){
      ctx.fillStyle = "silver";
      ctx.globalCompositeOperation = "source-over";
      ctx.fillRect(0,0,canvas.width,canvas.height);
      ctx.fillStyle = "#222"; ctx.font = "20px Arial"; ctx.textAlign = "center";
      ctx.fillText("Raspa para descubrir tu premio", canvas.width/2, 40);
      ctx.textAlign = "left";
    }

    let isDown = false, lastPoint = null, revealed = false;

    function scratchAt(clientX, clientY){
      const rect = canvas.getBoundingClientRect();
      const x = (clientX - rect.left) * (canvas.width / rect.width);
      const y = (clientY - rect.top) * (canvas.height / rect.height);
      ctx.globalCompositeOperation = "destination-out";
      ctx.beginPath(); ctx.arc(x, y, SCRATCH_RADIUS, 0, Math.PI*2); ctx.fill();
      lastPoint = {x,y};
    }

    function updateRevealedPercent(){
      const sample = ctx.getImageData(0,0,canvas.width,canvas.height).data;
      let cleared = 0, sampled = 0, step = 8;
      for(let i=3;i<sample.length;i+=4*step){ if(sample[i]===0) cleared++; sampled++; }
      const ratio = cleared/sampled;
      const percent = Math.round(ratio*100);
      progressTxt.textContent = revealed ? "Listo para reclamar" : `Raspa para desbloquear (${percent}%)`;
      if(!revealed && ratio >= UNLOCK_THRESHOLD){
        revealed = true;
        ctx.globalCompositeOperation = "destination-out";
        ctx.fillRect(0,0,canvas.width,canvas.height);
        claimBtn.disabled = false;
      }
    }

    canvas.addEventListener("mousedown", e=>{isDown=true});
    canvas.addEventListener("mouseup", e=>{isDown=false; updateRevealedPercent()});
    canvas.addEventListener("mousemove", e=>{if(isDown) scratchAt(e.clientX,e.clientY)});
    canvas.addEventListener("touchstart", e=>{isDown=true});
    canvas.addEventListener("touchend", e=>{isDown=false; updateRevealedPercent()});
    canvas.addEventListener("touchmove", e=>{if(isDown && e.touches[0]) scratchAt(e.touches[0].clientX,e.touches[0].clientY)});

    /***********************
     * ‚è≥ TIEMPO DE EXPIRACI√ìN
     ***********************/
    const STORAGE_KEY = "raspadita_inicio";
    function getStartMs(){
      const v = localStorage.getItem(STORAGE_KEY);
      return v ? parseInt(v,10) : null;
    }
    function startNowIfNeeded(){
      let start = getStartMs();
      if(!start){ start = Date.now(); localStorage.setItem(STORAGE_KEY, start); }
      return start;
    }
    function msLeft(){
      const start = startNowIfNeeded();
      const end = start + VALIDITY_HOURS*60*60*1000;
      return end - Date.now();
    }
    function formatHHMMSS(ms){
      if(ms<=0) return "00:00:00";
      const total = Math.floor(ms/1000);
      const h = String(Math.floor(total/3600)).padStart(2,"0");
      const m = String(Math.floor((total%3600)/60)).padStart(2,"0");
      const s = String(total%60).padStart(2,"0");
      return `${h}:${m}:${s}`;
    }
    function tick(){
      const left = msLeft();
      countdownEl.textContent = formatHHMMSS(left);
      if(left<=0){ expiredEl.classList.add("show"); claimBtn.disabled = true; }
    }
    setInterval(tick, 1000);

    /***********************
     * üì≤ RECLAMAR
     ***********************/
    claimBtn.addEventListener("click", () => {
      if(WHATSAPP_NUMBER){
        const msg = encodeURIComponent(WHATSAPP_MESSAGE);
        window.location.href = `https://wa.me/${WHATSAPP_NUMBER}?text=${msg}`;
      } else {
        alert("Configura tu n√∫mero de WhatsApp en el c√≥digo (WHATSAPP_NUMBER).");
      }
    });

    /***********************
     * üöÄ INIT
     ***********************/
    function init(){
      drawPrizeBackground();
      drawScratchLayer();
      tick();
    }
    window.addEventListener("load", init);
  </script>
</body>
</html>
