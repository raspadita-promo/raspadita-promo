<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Raspadita de Bienvenida üéÅ</title>
  <meta name="description" content="Raspa y descubre tu cup√≥n de bienvenida: 50% extra en tu primera carga. V√°lido 24 horas." />
  <style>
    :root{
      --bg1:#f8f9ff; --bg2:#eef2ff; --primary:#111827; --accent:#6366f1; --ok:#16a34a; --muted:#6b7280;
      --card:#ffffff; --shadow:0 10px 30px rgba(0,0,0,.12);
      --radius:22px;
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family: ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial;
      min-height:100vh; display:flex; align-items:center; justify-content:center;
      background: radial-gradient(1200px 600px at 10% 10%, var(--bg2), transparent),
                  radial-gradient(1200px 600px at 90% 90%, #ffe8ef, transparent),
                  var(--bg1);
      color:var(--primary);
    }
    .wrap{
      width:min(92vw, 560px);
      background:var(--card);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:22px;
    }
    header{
      display:flex; align-items:center; gap:12px; margin-bottom:14px;
    }
    .logo{
      width:42px; height:42px; border-radius:12px; background:#fff;
      box-shadow:0 4px 12px rgba(0,0,0,.08); display:grid; place-items:center; overflow:hidden;
      flex:0 0 auto;
    }
    .logo img{ width:100%; height:100%; object-fit:cover; }
    .ttl{ line-height:1.1; }
    .ttl h1{ font-size:20px; margin:0 0 4px; }
    .ttl p{ margin:0; color:var(--muted); font-size:14px; }

    .card{
      position:relative; border-radius:var(--radius);
      overflow:hidden; box-shadow:0 6px 18px rgba(0,0,0,.12);
    }
    canvas{ display:block; width:100%; height:auto; cursor:pointer; }
    .badge{
      position:absolute; top:10px; right:10px; background:var(--accent); color:#fff;
      padding:6px 10px; border-radius:999px; font-size:12px; box-shadow:0 4px 10px rgba(99,102,241,.4);
    }
    .cta{
      display:flex; flex-direction:column; align-items:center; gap:10px; margin-top:16px; text-align:center;
    }
    .btn{
      appearance:none; border:0; background:var(--ok); color:#fff; font-weight:700;
      padding:14px 18px; border-radius:16px; box-shadow:0 6px 16px rgba(22,163,74,.35);
      cursor:pointer; width:100%; font-size:16px; transition:transform .06s ease;
    }
    .btn:disabled{ background:#a3a3a3; box-shadow:none; cursor:not-allowed; }
    .btn:active{ transform:translateY(1px); }
    .meta{
      font-size:13px; color:var(--muted);
    }
    details{
      margin-top:10px; background:#f6f7ff; border-radius:14px; padding:10px 12px;
    }
    details summary{ cursor:pointer; font-weight:600; }
    .ribbon{
      position:absolute; left:10px; top:10px; padding:6px 10px; font-size:12px; background:#111827; color:#fff; border-radius:999px;
    }
    .expiredOverlay{
      position:absolute; inset:0; background:rgba(17,24,39,.72); color:#fff;
      display:none; align-items:center; justify-content:center; text-align:center; padding:20px;
    }
    .expiredOverlay.show{ display:flex; }
    .timer{
      display:inline-flex; gap:6px; align-items:center; font-feature-settings:"tnum";
      font-variant-numeric:tabular-nums;
    }
    .grid2{
      display:grid; grid-template-columns:1fr auto; gap:10px; align-items:center;
    }
  </style>
</head>
<body>
  <div class="wrap" role="main">
    <header>
      <div class="logo" aria-hidden="true">
        <!-- Si quieres, reemplaza el src del logo -->
        <img id="brandLogo" alt="Logo" src="" />
      </div>
      <div class="ttl">
        <h1>Raspadita de Bienvenida</h1>
        <p>Descubre tu cup√≥n exclusivo (neutro, sin tem√°tica de juegos).</p>
      </div>
    </header>

    <div class="card">
      <div class="ribbon">50% EXTRA</div>
      <div class="badge" id="timeBadge">
        <span class="timer">‚è≥ <span id="countdown">‚Äî:‚Äî:‚Äî</span></span>
      </div>
      <canvas id="scratch" width="520" height="300" aria-label="Raspadita: arrastra para revelar premio"></canvas>
      <div class="expiredOverlay" id="expired">
        <div>
          <h2 style="margin:0 0 6px">Cup√≥n expirado</h2>
          <p style="margin:0; opacity:.9">Vuelve a solicitar una nueva invitaci√≥n.</p>
        </div>
      </div>
    </div>

    <div class="cta">
      <div class="grid2" style="width:100%">
        <button id="claimBtn" class="btn" disabled>üéÅ Reclamar cup√≥n 50% extra</button>
        <div class="meta" id="progressTxt">Raspa para desbloquear (0%)</div>
      </div>
      <div class="meta">V√°lido solo por 24 horas desde tu primera visita.</div>
      <details>
        <summary>Ver t√©rminos</summary>
        <div class="meta" style="margin-top:8px; text-align:left">
          Promoci√≥n: 50% extra en la primera carga de bienvenida. V√°lido por 24 horas desde la primera visita a esta p√°gina en tu dispositivo.
          Beneficio no acumulable ni transferible. Sujeto a verificaci√≥n de cuenta. Nos reservamos el derecho de validar elegibilidad.
        </div>
      </details>
    </div>
  </div>

  <script>
    /***********************
     * üîß CONFIGURACI√ìN
     ***********************/
    const BRAND_NAME = "Tu Marca";              // Nombre p√∫blico
    const LOGO_URL = "";                        // Opcional: URL de tu logo (PNG/JPG). Si vac√≠o, se mostrar√° un √≠cono por defecto.
    const VALIDITY_HOURS = 24;                  // Duraci√≥n del cup√≥n desde la primera visita
    const SCRATCH_RADIUS = 26;                  // Radio del "raspado"
    const UNLOCK_THRESHOLD = 0.55;              // 55% revelado para habilitar reclamar
    const WHATSAPP_NUMBER = "";                 // Incluye c√≥digo de pa√≠s. Ej: "54911xxxxxxxx" (sin +)
    // Mensaje prellenado de WhatsApp al reclamar:
    const WHATSAPP_MESSAGE = `Hola, quiero reclamar mi cup√≥n de bienvenida 50% EXTRA de ${BRAND_NAME}.`;

    // Elementos
    const canvas = document.getElementById("scratch");
    const ctx = canvas.getContext("2d");
    const claimBtn = document.getElementById("claimBtn");
    const progressTxt = document.getElementById("progressTxt");
    const countdownEl = document.getElementById("countdown");
    const expiredEl = document.getElementById("expired");
    const brandLogo = document.getElementById("brandLogo");

    // Logo opcional
    if (LOGO_URL) {
      brandLogo.src = LOGO_URL;
      brandLogo.alt = BRAND_NAME;
    } else {
      // Fallback: dibuja un simple monograma si no hay logo
      brandLogo.remove(); // oculto img
      const box = document.querySelector(".logo");
      const span = document.createElement("span");
      span.textContent = BRAND_NAME.slice(0,1).toUpperCase();
      span.style.fontWeight = "800";
      span.style.fontSize = "20px";
      span.style.color = "#111";
      box.appendChild(span);
    }

    /***********************
     * üé® DIBUJA PREMIO
     * (no depende de im√°genes externas)
     ***********************/
    function drawPrizeBackground() {
      const w = canvas.width, h = canvas.height;
      // Fondo suave
      const g = ctx.createLinearGradient(0,0,w,h);
      g.addColorStop(0,"#ffffff");
      g.addColorStop(1,"#f0f4ff");
      ctx.fillStyle = g; ctx.fillRect(0,0,w,h);

      // Tarjeta central
      const cardPad = 18, r = 22;
      roundRect(ctx, cardPad, cardPad, w-2*cardPad, h-2*cardPad, r);
      ctx.fillStyle = "#ffffff"; ctx.fill();
      ctx.shadowColor = "rgba(0,0,0,.08)"; ctx.shadowBlur = 20; ctx.shadowOffsetY = 6;
      roundRect(ctx, cardPad, cardPad, w-2*cardPad, h-2*cardPad, r); ctx.strokeStyle = "rgba(0,0,0,.05)"; ctx.stroke();
      ctx.shadowColor = "transparent";

      // Texto principal
      ctx.fillStyle = "#111827";
      ctx.font = "bold 28px system-ui, -apple-system, Segoe UI, Roboto, Arial";
      ctx.fillText("Bienvenido/a üéâ", cardPad+24, cardPad+60);

      ctx.font = "600 24px system-ui, -apple-system, Segoe UI, Roboto, Arial";
      ctx.fillStyle = "#16a34a";
      ctx.fillText("Cup√≥n 50% EXTRA", cardPad+24, cardPad+100);

      ctx.font = "16px system-ui, -apple-system, Segoe UI, Roboto, Arial";
      ctx.fillStyle = "#374151";
      const line1 = "en tu primera carga de bienvenida";
      ctx.fillText(line1, cardPad+24, cardPad+130);

      // Etiqueta de validez
      ctx.font = "14px system-ui, -apple-system, Segoe UI, Roboto, Arial";
      ctx.fillStyle = "#6b7280";
      ctx.fillText("V√°lido por 24 horas desde tu primera visita", cardPad+24, h - cardPad - 24);

      // Peque√±o sello
      ctx.fillStyle = "#6366f1";
      roundRect(ctx, w - cardPad - 120, h - cardPad - 48, 110, 34, 10);
      ctx.fill();
      ctx.fillStyle = "#fff";
      ctx.font = "bold 14px system-ui, -apple-system, Segoe UI, Roboto, Arial";
      ctx.fillText("Uso √∫nico", w - cardPad - 85, h - cardPad - 26);
    }

    function roundRect(ctx, x, y, w, h, r){
      const rr = Math.min(r, w/2, h/2);
      ctx.beginPath();
      ctx.moveTo(x+rr, y);
      ctx.arcTo(x+w, y, x+w, y+h, rr);
      ctx.arcTo(x+w, y+h, x, y+h, rr);
      ctx.arcTo(x, y+h, x, y, rr);
      ctx.arcTo(x, y, x+w, y, rr);
      ctx.closePath();
    }

    /***********************
     * ü™Ñ CAPA RASCABLE
     ***********************/
    function drawScratchLayer(){
      // Capa met√°lica
      const w = canvas.width, h = canvas.height;
      const g = ctx.createLinearGradient(0,0,w,h);
      g.addColorStop(0, "#cfd4da");
      g.addColorStop(1, "#a9b0b7");
      ctx.fillStyle = g;
      ctx.globalCompositeOperation = "source-over";
      ctx.fillRect(0,0,w,h);

      // Textura de l√≠neas finas
      ctx.globalAlpha = 0.25;
      ctx.fillStyle = "rgba(255,255,255,0.3)";
      for(let i=0;i<w;i+=8){
        ctx.fillRect(i,0,1,h);
      }
      ctx.globalAlpha = 1;

      // Mensaje encima
      ctx.fillStyle = "rgba(17,24,39,.9)";
      ctx.font = "bold 20px system-ui, -apple-system, Segoe UI, Roboto, Arial";
      ctx.textAlign = "center";
      ctx.fillText("Raspa para revelar tu cup√≥n", w/2, 40);
      ctx.textAlign = "left";
    }

    // Estados de interacci√≥n
    let isDown = false;
    let lastPoint = null;
    let revealed = false;

    function scratchAt(clientX, clientY){
      const rect = canvas.getBoundingClientRect();
      const x = (clientX - rect.left) * (canvas.width / rect.width);
      const y = (clientY - rect.top) * (canvas.height / rect.height);
      ctx.globalCompositeOperation = "destination-out";
      ctx.beginPath();
      ctx.arc(x, y, SCRATCH_RADIUS, 0, Math.PI*2);
      ctx.fill();
      if(lastPoint){
        // Uni√≥n suave de puntos para no dejar gaps
        const dx = x - lastPoint.x, dy = y - lastPoint.y;
        const dist = Math.hypot(dx, dy);
        const steps = Math.ceil(dist / (SCRATCH_RADIUS/2));
        for(let i=1;i<steps;i++){
          const ix = lastPoint.x + dx * (i/steps);
          const iy = lastPoint.y + dy * (i/steps);
          ctx.beginPath(); ctx.arc(ix, iy, SCRATCH_RADIUS, 0, Math.PI*2); ctx.fill();
        }
      }
      lastPoint = {x,y};
    }

    function handlePointerDown(e){
      if(checkExpired()) return;
      isDown = true;
      lastPoint = null;
    }
    function handlePointerUp(e){
      isDown = false;
      lastPoint = null;
      // Calcular porcentaje revelado solo al soltar (rendimiento)
      updateRevealedPercent();
    }
    function handlePointerMove(e){
      if(!isDown || checkExpired()) return;
      if(e.touches && e.touches[0]){
        scratchAt(e.touches[0].clientX, e.touches[0].clientY);
      } else {
        scratchAt(e.clientX, e.clientY);
      }
      e.preventDefault();
    }

    canvas.addEventListener("mousedown", handlePointerDown);
    canvas.addEventListener("mousemove", handlePointerMove, {passive:false});
    window.addEventListener("mouseup", handlePointerUp);

    canvas.addEventListener("touchstart", handlePointerDown, {passive:true});
    canvas.addEventListener("touchmove", handlePointerMove, {passive:false});
    window.addEventListener("touchend", handlePointerUp);

    function updateRevealedPercent(){
      try{
        // Tomamos una muestra de p√≠xeles (no toda la imagen para rendimiento)
        const sample = ctx.getImageData(0,0,canvas.width,canvas.height).data;
        let cleared = 0, total = canvas.width*canvas.height;
        // Contamos alfa=0 (borrado) mirando cada 8vo pixel aprox
        let step = 8;
        let sampled = 0;
        for(let i=3;i<sample.length;i+=4*step){
          if(sample[i]===0) cleared++;
          sampled++;
        }
        const ratio = cleared / sampled;
        const percent = Math.round(ratio*100);
        progressTxt.textContent = revealed
          ? "Listo para reclamar"
          : `Raspa para desbloquear (${percent}%)`;

        if(!revealed && ratio >= UNLOCK_THRESHOLD){
          revealed = true;
          // Limpia completamente la capa para mostrar el premio bonito
          ctx.globalCompositeOperation = "destination-out";
          ctx.fillRect(0,0,canvas.width,canvas.height);
          claimBtn.disabled = false;
          progressTxt.textContent = "Listo para reclamar";
        }
      }catch(err){
        // Si falla getImageData por alguna raz√≥n, no rompemos la UX
        console.warn(err);
      }
    }

    /***********************
     * ‚è≥ L√ìGICA DE EXPIRACI√ìN
     ***********************/
    const STORAGE_KEY = "scratch_welcome_started_at";
    function getStartMs(){
      const v = localStorage.getItem(STORAGE_KEY);
      return v ? parseInt(v,10) : null;
    }
    function startNowIfNeeded(){
      let start = getStartMs();
      if(!start){
        start = Date.now();
        localStorage.setItem(STORAGE_KEY, String(start));
      }
      return start;
    }
    function msLeft(){
      const start = startNowIfNeeded();
      const end = start + VALIDITY_HOURS*60*60*1000;
      return end - Date.now();
    }
    function checkExpired(){
      const left = msLeft();
      const expired = left <= 0;
      expiredEl.classList.toggle("show", expired);
      claimBtn.disabled = expired || !revealed;
      return expired;
    }
    function formatHHMMSS(ms){
      if(ms<=0) return "00:00:00";
      const total = Math.floor(ms/1000);
      const h = String(Math.floor(total/3600)).padStart(2,"0");
      const m = String(Math.floor((total%3600)/60)).padStart(2,"0");
      const s = String(total%60).padStart(2,"0");
      return `${h}:${m}:${s}`;
    }
    function tick(){
      const left = msLeft();
      countdownEl.textContent = formatHHMMSS(left);
      checkExpired();
    }
    setInterval(tick, 1000);

    /***********************
     * üì≤ RECLAMO
     ***********************/
    claimBtn.addEventListener("click", () => {
      if(checkExpired()) return;
      // Puedes cambiar aqu√≠ la acci√≥n de ‚Äúreclamar‚Äù
      // Opci√≥n 1: WhatsApp
      if(WHATSAPP_NUMBER){
        const msg = encodeURIComponent(WHATSAPP_MESSAGE);
        const url = `https://wa.me/${WHATSAPP_NUMBER}?text=${msg}`;
        window.location.href = url;
      } else {
        // Opci√≥n 2: Copiar mensaje al portapapeles y mostrar alerta
        const msg = `${WHATSAPP_MESSAGE}`;
        navigator.clipboard?.writeText(msg);
        alert("¬°Listo! Mensaje para enviar copiado al portapapeles.");
      }
    });

    /***********************
     * üöÄ INICIALIZACI√ìN
     ***********************/
    function init(){
      // Dibuja premio y capa rascable
      drawPrizeBackground();
      drawScratchLayer();
      // Arranca contador
      tick();
    }
    // Para asegurar que canvas tenga layout correcto antes de dibujar
    window.addEventListener("load", init);
  </script>
</body>
</html>
